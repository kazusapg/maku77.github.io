---
title: Python での正規表現の扱い方まとめ
created: 2014-06-02
---

正規表現リテラル
====
リテラルとして正規表現を表すときは、プレフィックスに ```r``` を付けることで、```\``` を ```\\``` とエスケープしなくてもよくなります。
下記の二行は同じ正規表現を表しています。

```python
r'\W(.)\1\W'
'\\W(.)\\1\\W'
```


正規表現パターンのコンパイル
====
```re.match()```、```re.search()``` などで、正規表現パターンを毎回指定してマッチングを行うことはできますが、同じ正規表現パターンを繰り返し使用する場合は、あらかじめ正規表現オブジェクトにコンパイルしておくと高速に処理できます。

```python
import re

# コンパイルしない場合
match = re.search(r'\d+', 'abc123')

# コンパイルする場合
regex = re.compile(r'\d+')
match = regex.search('abc123')
```

ただし、```re.match()```、```re.search()``` に最後に渡されたパターンは、内部的にキャッシュされているので、パターンを 1 つのみ使用する場合は、```re.compile()``` の必要はありません。


一致するかを調べる（一致する部分を抽出する）
====

* 先頭からの一致を調べる: ```re.match(pattern, string)```
* 部分的な一致を調べる: ```re.search(pattern, string)```

コンパイル済み正規表現オブジェクトを使う場合も同様のメソッドを使用します。

* 先頭からの一致を調べる: ```regex.match(string)```
* 部分的な一致を調べる: ```regex.search(string)```

これらのメソッドは、Match オブジェクトを返します。
一致しない場合は ```None``` を返すので、そのまま ```if``` に渡して、一致したかを確認できます。
一致した場合は、実際に一致する部分を抽出することができます。

```python
import re

match = re.search(r'(\d+)', 'aaa123bbb')
if match:
    print(match.group(1))  #=> '123'
```

パターンに一致する部分を繰り返し抽出する
====

```re.findall()``` を使用すると、パターンに一致する部分を繰り返し抽出します
（```re.search()``` や ```re.match()``` は、あくまで、全体と一回だけマッチングします）。

```python
import re

arr = re.findall(r'\d+', 'a100b200c300')  #=> [100, 200, 300]
```

```re.findall()``` の場合、戻り値は文字列のリストになります。


パターンに一致する部分を置換する
====

```python
import re

result = re.sub(r'(\d+)', r'<\1>', 'aa11bb22cc')  #=> 'aa<11>bb<22>cc'
```

いくつ置換したかを調べるには、```re.subn()``` を使用します。

```python
import re

result, num = re.subn(r'(\d+)', r'<\1>', 'aa11bb22cc')  #=> num は 2
```

