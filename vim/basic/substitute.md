---
title: 文字の置換方法いろいろ (:substitute)
date: "2007-01-08"
---


パターンに一致する文字列を置換する
----

#### 構文

~~~ vim
:行範囲 s/置換前テキスト/置換後テキスト/フラグ
~~~

行範囲の指定を省略した場合は、カレント行のみが置換対象になります。
全ての行を置換対象にしたい場合は、`%` を指定します。

デフォルトでは、各行で最初に見つかった文字列だけを置換しますが、フラグに `g`（global フラグ）を指定することで、行内のすべての文字列を置換するようになります。

~~~ vim
:s/old/new/         "カレント行の文字列を置換（1 つだけ置換）
:s/old/new/g        "カレント行の文字列を置換（すべて置換）
:% s/old/new/g      "ファイル全体の文字列を置換
:1,$ s/old/new/g    "ファイル全体の文字列を置換（同上）
~~~

#### 例: ファイル全体の google を google.com に置換する

~~~ vim
:% s/google/&.com/g
~~~

置換文字列の中の `&` は検索パターンにマッチしたテキスト全体を表します。

#### 例: すべての行の Help を大文字の HELP に置換する

~~~
:% s/help/\U&/g
~~~

`\U` は大文字に変換する命令です。

#### 例: カレント行をすべて大文字に置換する

~~~
:s/.*/\U&/g
~~~

`Shitf-V` で行全体を選択して、`U` と入力しても同様のことを行えます。

#### 例: ファイル全体の /home/aaa を /home/bbb に置換する

~~~ vim
:% s;/home/aaa;/home/bbb;g
~~~

区切り文字には、`/` 以外にもほとんど種類の記号が使えます。
上記の例では、区切り文字として `;` を使っています。

#### 例: 単語の境界を意識して child を children に置換する

~~~ vim
:% s/\<child\>/children/g
~~~

単語の境界を表すには、`\<` と `\>` を使います。

#### 例: カレント行から 5 行文の行頭に引用記号 (> ) を挿入する

~~~ vim
:.,+4 s/^/> /
~~~

こんな置換コマンド入力するくらいなら、`Ctrl+V` による矩形選択で一括置換した方が速いですね。
マクロなら使い道があるかもしれません。

#### 例: 5 行目から 10 行目までの文字列の置換

~~~ vim
:5,10 s/old/new/g
~~~

行番号をこのように具体的に指定して置換範囲を指定する方法もありですが、`Shift + V` による行選択してから `:s ほげほげ`、と置換コマンドを実行する方が、置換範囲が目に見えるのでおすすめです。
プログラムの変数名を置換をするときに、置換範囲を制限したい場合に便利です。


パターンに一致する文字列を削除する
----

`s` コマンドによる置換の、置換後の文字列を空にしておけば、パターンに一致する文字列の削除が可能です。

#### 例: 行の先頭の半角スペースをすべて削除

~~~ vim
:% s/^ \+//
~~~

Vim では、正規表現の `+` は `\+` とエスケープしないといけないことに注意してください。


１単語ずつ確認しながら置換する
----

~~~ vim
:% s/old/new/gc
~~~

置換時のフラグに `c`（confirm フラグ）を指定すると、ひとつずつ置換するかどうか確認しながら置換していくことができます (y or n)。
ハイライトされた単語を置換するなら `y`、置換しないなら `n` を入力していきます。


検索しながら繰り返しコマンドで置換する方法
----

ちょっとマニアックですが、こんな手順で置換を繰り返していくこともできます。

1. `/<単語>` で目的の単語を検索。
2. `cw` で単語を置き換え、`ESC` で insert モードを抜ける。
3. `n` で次の単語に移り、置換したい場合は `.` で置換。あとは 3 を繰り返す。

#### 例: old という単語を検索しながら new に置き換えていく

~~~ vim
/old
cwnew [Esc]
nnnn
.
nnn
.
~~~

まず `old` というテキストを検索し、`cw` コマンドでその単語を `new` に置換します。
あとは、`n` で次の単語を検索して置換したい位置で `.` によって置換コマンドを繰り返します。

