---
title: 不具合修正では不具合を入れてしまった原因を取り除く
created: 2015-05-26
layout: bestpractice
---

ソフトウェアの実装に不具合が見つかった時、正しく動作するように修正するだけでは不十分です。
継続的に設計を改善していくためには、どうしてそのような不具合となるコーディングを行ってしまったのか、その原因を突き止め、取り除いていく必要があります。
例えば、以下のような感じです。

### 原因: 変数名やメソッド名から実際の振る舞いが想像できず、間違った使い方をしてしまった。

正しい使い方をするように修正するだけでなく、原因となった変数名やメソッド名を、意図の分かる名前に変更しましょう。また、ドキュメンテーションコメントが不十分であれば補足します。メソッドにテストコードがなければ追加し、メソッドの振舞いを明確にします。
定数が int や String といったプリミティブ型で定義されている場合は、列挙型に変更することで、誤った使われ方を防ぐことができるかもしれません。

### 原因: 不具合を修正したら、思わぬメソッドの戻り値に副作用が出て、別の不具合を埋め込んでしまった。

いわゆるエンバグというやつです。複雑なメソッドを修正する場合にはエンバグのリスクは付き物です。副作用に気付けなかったのは、そのメソッドにテストコードがなかったからです。テストコードを追加し、間違った修正をしてしまった場合に、その場で気が付けるようにしましょう。

### 原因: 仕様書の記述があいまいで、要求通りの実装になっていなかった。

口頭で確認するだけでなく、仕様書の記載を明確にしましょう。また、その仕様に関する部分のテストコードを記述し、その振舞いが要求を満たしているのかを確認しましょう。仕様が複雑な場合は、コード内に仕様書へのリンクを埋め込んだり、詳しいドキュメンテーションコメントを記述しておかなければいけません。将来的にそのコードをメンテナンスする人のことを考えれば、それがどれだけ重要なことか分かるはずです。また、その複雑な仕様が、ユーザにとっても複雑なものになっているのであれば、仕様自体をシンプルにできないか見直すべきです。

経験を積んだ設計者は、その場の修正が楽だからという理由で修正方法を決めたりはしません。
不具合の原因となったコードは、将来的にも同じような不具合を生み出し、もっと苦労することを知っているからです。
誰かが間違えてしまった部分は、他の人も間違える可能性が高いのです（それは将来のあなたかもしれません）。
同じ過ちを繰り返さないように導いてください。

その場しのぎの不具合修正を繰り返しているとつらいだけです。
分かりにくいコードをそのままにしておくのは精神的にもよくありません。
不具合を見つけたときは、設計を改善するためのよい機会だと思いましょう。
修正箇所にテストコードが存在しないのであれば、テストコードを追加する絶好のチャンスです。

